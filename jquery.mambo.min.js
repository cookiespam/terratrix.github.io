/*
 * Mambo jQuery Plugin
 * @author: Valerio Barrila aka NinjaTux
 * @twitter: ninjatux2k
*/
(function (e,t,n,r){"use strict";function a(t,n){this.element=t;this.options=e.extend(true,{},s,n);this._defaults=s;this._name=i;this.init()}var i="mambo",s={percentage:100,circleColor:"#ffbe00",circleBorder:"#ffbe00",ringStyle:"percentage",ringColor:"#FF8C0D",ringBackground:"#CCC",labelColor:"#fafafa",displayValue:true,drawShadow:false},o=Math.PI/180,u=2*Math.PI;a.prototype={init:function(){if(this.checkCanvas()){this.context=this.element.getContext("2d");this.percentage=this.options.percentage*3.6;this.points=this.getPoints();e(this.element).css({width:this.points.width+"px",height:this.points.width+"px"});this.linesAndRadiuses=this.getLinesAndRadiuses();if(this.options.percentage>0){this.drawPercentage()}this.drawInternalCircle();this.drawText()}},drawInternalCircle:function(){this.context.beginPath();this.context.moveTo(this.points.x,this.points.x);this.context.arc(this.points.x,this.points.x,this.linesAndRadiuses.internalRadius,0,u,false);this.context.fillStyle=this.options.circleColor;this.context.lineWidth=this.linesAndRadiuses.internalLine;this.context.closePath();this.context.strokeStyle=this.options.circleBorder;this.context.stroke();this.context.fill()},drawPercentage:function(){this.context.beginPath();this.context.moveTo(this.points.x,this.points.x);this.context.arc(this.points.x,this.points.x,this.linesAndRadiuses.externalRadius,this.points.angle.start,this.points.angle.end,false);this.context.closePath();this.context.fillStyle=this.options.ringColor;this.context.fill()},drawText:function(){var e;this.context.textAlign="center";this.context.fillStyle=this.options.labelColor;this.context.textBaseline="bottom";if(this.options.displayValue){e=this.points.width/3.5;this.context.font="bold "+e+"px helvetica";if(this.options.label&&this.options.label.length>0){this.context.fillText(this.options.label,this.points.x,this.points.x+this.linesAndRadiuses.internalRadius/25);this.context.fillText(this.options.percentage+"%",this.points.x,this.points.x+this.linesAndRadiuses.internalRadius/1.5)}else{this.context.fillText(this.options.percentage+"%",this.points.x,this.points.x+this.linesAndRadiuses.internalRadius/2.3)}}else{e=this.points.width/2.5;this.context.font="bold "+e+"px helvetica";this.context.fillText(this.options.label,this.points.x,this.points.x+this.linesAndRadiuses.internalRadius/1.8)}},checkCanvas:function(){return!!(this.element.getContext&&this.element.getContext("2d"))},getPoints:function(){return{width:this.element.width,x:this.element.width/2,angle:{start:this.percentage===360?0:270*o,end:this.percentage===360?u:(this.percentage-90)*o}}},getLinesAndRadiuses:function(){var e=this.points.width/30,t=this.points.x-e/2,n=t,r=this.points.width/35,i=n*.8;return{shadowLine:e,shadowRadius:t,externalRadius:n,internalLine:r,internalRadius:i}}};e.fn[i]=function(t){return this.each(function(){if(!e.data(this,"plugin_"+i)){e.data(this,"plugin_"+i,new a(this,t))}})}})(jQuery,window,document)